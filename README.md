# umaumafancount-mp4tocsv(JSONにしました)

## 概要
ゲーム画面の録画（MP4）から、ファン人数を抽出しjsonとして出力するスクリプトです。

* 指定した動画（MP4）からフレームを自動抽出
* OCR結果から日本語の名前とカンマ区切りの数値（例：3,249,444,186）を抽出

## 環境について

* Windows11
* python 3.13
* FullHDのモニターを持っている

## インストール手順

### pythonのインストール

1. Microsoft Store を開きます
2. 検索欄に「Python 3.12」と入力し、Microsoft 発行の Python を **入手（インストール）**します
3. インストール後、Windows キー → cmd と打って Enter（黒い画面が開きます）
4. 次を入力して Enter：
```
python --version
```
 3.12.xと表示されればＯＫ

### リポジトリをダウンロード

#### Gitでクローン

```
git clone <このリポジトリ>
cd umaumafancount-mp4tocsv
```

#### ZIPでダウンロード

1. umaumafancount-mp4tocsv右上の「Code」をクリック
2. 「Download ZIP」をクリック
3. ローカルに保存されるので解凍して好きなところに置く

### 利用手順

* `input/memberList.txt`に以下を参考にしてメンバー名を列挙する
```
メンバーA
メンバーB
万丈目準
伝説のフィッシャーマン
笹波雲明
.
.
.
.
.
```
* `pip install nv`を実行する
* FullHDのモニターに全画面表示で表示する
* 以下の画像を参考にサークル画面でメンバー全員が映るように動画を撮影する。※マウスカーソルがメンバー名・人数に映ってしまうと文字認識できないためスクロールバーに合わせること
<img src="./docs/images/circle.png">

* 2で撮影した動画を`input/`に格納する。
* `nv run main.py <格納した動画ファイル名>`を実行する
* `output/output.json`に以下のような形で出力される
```
{
"メンバーA": 1234567890,
"メンバーB": 987654321,
"万丈目準": 110100100010000,
"伝説のフィッシャーマン": 18501600,
"笹波雲明": 8910
}
```

#### 注意点

* WinRTを利用しているため、LinuxやMac環境での利用は想定していません。
* 動画撮影時にスクロールが速すぎるとフレームのタイミングによっては抽出が行えません
* 文字認識の精度場つぶれてしまう場合があります。（例えば「ザ」と「サ」等）
  * メンバー名に応じて`input/menberReplace.json`でマッピングしてください。
  * "工"藤とアイウ"エ"オが間違うパターンもあります。メンバー名によってパターンが膨大ですのでこちらでの対応は難しいです。
* 処理実行中に出力される画像等については最後にクリーニング処理を行います。手動で削除した場合が処理が正常に行えません
* FullHD解像度での動作確認しか行っていないため、WQHD、4Kでの動作は保証しません
  * おそらくですがWQHD、UWQHDでの動作はしないと思います。（無責任）